<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Joel's Brain Repo]]></title><description><![CDATA[A central repository of ramblings about code and other things.]]></description><link>https://joelfooxj.github.io/</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 13 May 2021 18:12:06 GMT</lastBuildDate><item><title><![CDATA[EC2 monitoring with iOS notifications]]></title><description><![CDATA[Perform simple AWS EC2 monitoring with notifications to iOS devices]]></description><link>https://joelfooxj.github.io//posts/ec2-ios-monitoring</link><guid isPermaLink="false">https://joelfooxj.github.io//posts/ec2-ios-monitoring</guid><pubDate>Tue, 11 May 2021 20:35:56 GMT</pubDate><content:encoded>&lt;p&gt;I had setup a couple of EC2 instances to execute OQ engine runs. Unfortunately, I could not automate the setup and teardown of each run since each run had its own specific post-processing of data that needed to be done. One gigantic worry I had was that I’d complete all my work on the instance and then just forget to stop it, incurring unnused hours of runtime on a (potentially) expensive instance. For example, if I had forgotten to turn off a x1.32xlarge instance and just let it run overnight, it would’ve cost 8hrs * $USD 13 = $USD 104! A very expensive mistake. &lt;/p&gt;
&lt;p&gt;I wanted a simple reminder pushed to my phone (being high in the order of things that catch and redirect my attention) about whether I had any EC2 instances currently running when they’re not supposed to and be promptly shut down. To do this, I set a cron job that called a script every half hour to my AWS account and checked for running EC2 instances. If there were, a notification is sent to my iPhone.  &lt;/p&gt;
&lt;p&gt;The following steps assume that you already have an AWS account with EC2 instances running, as well as adequare knowledge of setupin your local python environment.&lt;/p&gt;
&lt;h2 id=&quot;preparing-your-environment&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#preparing-your-environment&quot; aria-label=&quot;preparing your environment permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Preparing your environment&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Download and install the AWS CLI: &lt;a href=&quot;https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Installing, updating, and uninstalling the AWS CLI version 2&lt;/a&gt; &lt;/li&gt;
&lt;li&gt;Install Python 3.6 or later, and then install the Boto3 library: &lt;a href=&quot;https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Installing the Boto3 library&lt;/a&gt;. This library is an official AWS SDK to interact with AWS services via python. &lt;/li&gt;
&lt;li&gt;[Install the requests library for python] (&lt;a href=&quot;https://docs.python-requests.org/en/master/user/install/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;https://docs.python-requests.org/en/master/user/install/&lt;/a&gt;) &lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.pushcut.io/&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Install PushCut into your iOS device&lt;/a&gt;. We will use this to call webhooks that send push notifications to the iOS device that you’ve installed it on. &lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;monitoring-script&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#monitoring-script&quot; aria-label=&quot;monitoring script permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Monitoring script&lt;/h2&gt;
&lt;p&gt;This is the python script that I’ve used:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; boto3 
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; requests &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; rq

ec2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; boto3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;resource&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ec2&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
instances &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ec2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;instances&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    Filters&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Name&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;instance-state-name&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Values&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;running&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instances&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
	&lt;span class=&quot;token comment&quot;&gt;# there are instances running &lt;/span&gt;
	rq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;https://api.pushcut.io/&amp;lt;your secret token goes here&gt;/notifications/&amp;lt;your custom notification name goes here&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The script simply enumerates through the ec2 resources and checks if there are any that are currently running. If there are any running instances, it sends a GET request to the PushCut url as defined in your app. See the &lt;a href=&quot;https://www.pushcut.io/help#web_api&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;Webhook&lt;/a&gt; section in the PushCut help section to get started on defining custom webhooks. &lt;/p&gt;
&lt;p&gt;Save this script somewhere and remember the path to it. &lt;/p&gt;
&lt;h2 id=&quot;setting-up-the-cron-jobtask-scheduler&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#setting-up-the-cron-jobtask-scheduler&quot; aria-label=&quot;setting up the cron jobtask scheduler permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Setting up the cron job/task scheduler&lt;/h2&gt;
&lt;p&gt;For Linux/MacOS, type the following command into your terminal to set up a cron job: &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;0,30&lt;/span&gt; * * * * &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;path to your python program here&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;path to your script here&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;.py &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This calls the script every 0th and 30th minute of every hour.&lt;/p&gt;
&lt;p&gt;For Windows, follow the instructions &lt;a href=&quot;https://www.windowscentral.com/how-create-automated-task-using-task-scheduler-windows-10&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener noreferrer&quot;&gt;here&lt;/a&gt;. &lt;/p&gt;</content:encoded></item></channel></rss>